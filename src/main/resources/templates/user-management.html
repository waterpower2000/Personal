<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
	  layout:decorate="~{layouts/home_layout.html}">

<head>
  
  <title>User Management</title>
 
</head>

<body>

 
  <main id="main" class="main" layout:fragment="content">

    <div class="pagetitle">
      <h1>User Management</h1>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#"><p th:text="${reg}"></p></a></li>
      </ol>
    </div><!-- End Page Title -->
      <div th:if="${session.message}" class="container">
          <div class="alert alert-success text-center" role="alert">
              <span th:text="${session.message.content}"></span>
          </div>
          <th:block th:text="${#session.removeAttribute('message')}"></th:block>
      </div>
      <form action="#" th:action="@{/app/user/create-user.html}" method="post" th:object="${createUser}">
        <div class="container">
          <div class="card py-4 px-4">
            <div class="row">
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="Username" th:field="*{userCode}" required="required">
                </div>
                <div class="col-md-6">
                    <input type="password" class="form-control" placeholder="Password" th:field="*{userPass}" required="required">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="First Name" th:field="*{firstName}" required="required">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" placeholder="Last Name" th:field="*{lastName}" required="required">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">

                    <select class="form-select" th:field="*{userRole}">
                        <option th:each="role: ${ROLES}" th:value="${role.roleCode}" th:text="${role.roleName}"></option>
                    </select>
                </div>
                <div class="col-md-6">
                    <select class="form-select" aria-label="Default select example" th:field="*{regionId}">
						 <option th:style="@{font-size:15px}" th:each="reg : ${allRegion}" th:value="${reg.id}" th:text="${reg.regionName}"></option>
                     <!--    <option value="ALL">ALL</option>
                       <option th:each="region : ${allRegion}" th:value="${region.id}" th:text="${region.id}"></option>-->
                    </select>
                </div>
             <!--    <div class="col-md-4">
                    <select class="form-select" aria-label="Default select example" th:field="*{region}">
                        <option value="REGION_1">REGION_1</option>
                        <option value="REGION_2">REGION_2</option>
                        <option value="REGION_3">REGION_3</option>
                        <option value="ALL">ALL</option>
                       <option th:each="region : ${allRegion}" th:value="${region.id}" th:text="${region.id}"></option>
                    </select>
                </div>-->
            </div>
              <div class="form-group mt-3">
                <button class="btn btn-primary btn-user btn-block" type="submit">ADD</button>
            </div>
          </div>
        </div>

      </form>
      
      
      <div class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Users</h4>
                    </div>
                    <div class="card-body">
                        
                        <table id="datatable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                            <thead>
                            <tr>
                                <th>Username</th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Enabled</th>
                                <th>Roles</th>
                                <th>Action</th>
                                
                                
                            </tr>
                            </thead>
                            <tbody>
                                <tr th:each="user: ${USERS}">
                                    <td th:text="${user.getUserCode()}"></td>
                                    <td th:text="${user.getFirstName()}"></td>
                                    <td th:text="${user.getLastName()}"></td>
                                    <td th:text="${user.isEnabled() ? 'Yes' : 'No'}"></td>
                                    <td>
                                        <div th:each="role: ${user.getRoles()}" th:text="${role.getRoleName()}"></div>
                                    </td>
                                    <td><a th:href="@{/app/user/delete/{id}(id=${user.getUserCode()})}"><button class="btn btn-primary btn-user btn-block" type="submit">Delete User </button></a></td>
                                    
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="addUserModal" style="z-index: 99999" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content" id="addUserModalContent">
                </div>
            </div>
        </div>
    </div>
    <script layout:fragment="jqueryScript" type="application/javascript">
        $(document).ready(function() {
            var table = $('#datatable').DataTable({
                "pagingType": "full_numbers",
                "columnDefs": [
                    { "width": "15%" },
                    { "width": "15%" },
                    { "width": "15%" },
                    { "width": "15%" },
                    { "width": "20%" },
                    { "width": "20%" }
                ],
                responsive: true,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search records",
                }

            });
            table.on('click', '.edit', function() {
                $tr = $(this).closest('tr');

                var data = table.row($tr).data();
                alert('You press on Row: ' + data[0] + ' ' + data[1] + ' ' + data[2] + '\'s row.');
            });
        });
    </script>
    <script layout:fragment="normalScript" type="application/javascript">
        function addUser() {
            $.ajax({
                url: '/app/user/add-users.html',
                type: 'get',
                success: function(response){
                    $("#addUserModalContent").html(response);
                    $("#addUserModal").modal('show');
                },
                error: function(a, b, c) {
                    demo.showErrorNotification("Failed to add user. "+a.responseJSON.error)
                }
            });
        }

        function toggleUserStatus(elm) {
            var usercode = $(elm).attr("usercode");
            $.ajax({
                url: '/app/user/toggle-user-status.html?userCode='+usercode,
                type: 'post',
                success: function(response){
                    window.location.reload();
                },
                error: function(a, b, c) {
                    demo.showErrorNotification("Failed to change user status. "+a.responseJSON.error)
                }
            });
        }

        function manageUserRole(elm) {
            var usercode = $(elm).attr("usercode");
            $.ajax({
                url: '/app/user/manager-user-role.html?userCode='+usercode,
                type: 'get',
                success: function(response){
                    $("#addUserModalContent").html(response);
                    $("#addUserModal").modal('show');
                },
                error: function(a, b, c) {
                    demo.showErrorNotification("Failed to manage user role. "+a.responseJSON.error)
                }
            });
        }

        function assignRole(elm) {
            var rolecode = $(elm).attr("rolecode");
            var usercode = $(elm).attr("usercode");
            $.ajax({
                url: '/app/user/grant-role.html?roleCode='+rolecode+'&userCode='+usercode,
                type: 'post',
                success: function(response){
                    $("#addUserModalContent").html(response);
                },
                error: function(a, b, c) {
                    demo.showErrorNotification("Failed to assign role. "+a.responseJSON.error)
                }
            });
        }

        function revokeRole(elm) {
            var rolecode = $(elm).attr("rolecode");
            var usercode = $(elm).attr("usercode");
            $.ajax({
                url: '/app/user/revoke-role.html?roleCode='+rolecode+'&userCode='+usercode,
                type: 'post',
                success: function(response){
                    $("#addUserModalContent").html(response);
                },
                error: function(a, b, c) {
                    demo.showErrorNotification("Failed to assign role. "+a.responseJSON.error)
                }
            });
        }
    </script>

  </main><!-- End main -->

 
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  
</body>

</html>